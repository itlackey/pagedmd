/**
 * Core Layout - Universal Page Structure & Templates
 *
 * Professional @page rules for Paged.js
 * Digest format (6x9 default) with proper bleed and crop marks
 * Auto-rules for H1 headings, page breaks, and full-bleed images
 *
 * These templates apply to ANY book genre. Override or extend
 * for genre-specific page templates.
 */

/* ========================================
   BASE PAGE SETUP
   ======================================== */

@page {
  /* Standard digest size (configurable via CSS variables) */
  size: 6in 9in;

  /* Margins optimized for binding */
  margin-top: 0.75in;
  margin-bottom: 0.75in;

  /* Bleed zone for professional printing */
  bleed: 0.125in;

  /* Crop marks for trimming */
  marks: none;

  /* Prevent orphans and widows */
  orphans: 3;
  widows: 3;
}

/* ========================================
   LEFT & RIGHT PAGES
   ======================================== */

/* Left page (even numbers) - binding on left */
@page :left {
  margin-left: 0.75in;
  /* Inner (binding edge) */
  margin-right: 0.5in;
  /* Outer (trim edge) */

  @top-left {
    content: string(section-title);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  @bottom-left {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}

/* Right page (odd numbers) - binding on right */
@page :right {
  margin-left: 0.5in;
  /* Outer (trim edge) */
  margin-right: 0.75in;
  /* Inner (binding edge) */

  @top-right {
    content: string(book-title);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  @bottom-right {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}

/* First page of document */
@page :first {
  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: none;
  }
}

/* ========================================
   NAMED PAGE TEMPLATES
   ======================================== */

/* Chapter Opening Pages
   Universal convention: chapters start on right-hand pages with
   extra top margin for dramatic impact. */
@page chapter {
  margin-top: 40mm;
  /* Dramatic chapter start */

  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}

@page chapter:left {
  @bottom-left {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }

  @bottom-right {
    content: none;
  }
}

/* Full-Bleed Artwork Pages
   For illustrations, photographs, or any full-page visuals */
@page art {
  margin: 0;
  /* Full bleed to edge */

  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: none;
  }
}

/* Body Content Pages (Default)
   Renamed from "rules" for universal applicability.
   Use this for main body text in novels, textbooks, manuals, etc. */
@page body {
  /* Inherits base page margins */

  @top-center {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }

  @bottom-center {
    content: string(section-title);
    font-family: var(--font-ui);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }
}

/* Appendix Pages
   For supplementary material, references, indices */
@page appendix {
  @top-center {
    content: "Appendix";
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
  }

  @bottom-center {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}


/* Book Cover */
@page cover {
  margin: 0;
  bleed: 0.125in;

  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: none;
  }
}

/* Title Page */
@page title-page {
  margin: 1.5in 1in;

  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: none;
  }
}

/* Credits Page */
@page credits {
  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-center {
    content: counter(page, lower-roman);
    font-family: var(--font-ui);
    font-size: var(--font-size-xs);
  }
}

/* Table of Contents */
@page toc {
  @top-center {
    content: "Contents";
    font-family: var(--font-heading);
    font-size: var(--font-size-sm);
    letter-spacing: var(--tracking-wide);
  }

  @bottom-center {
    content: counter(page, lower-roman);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}

/* Glossary/Index
   Reduced margins for two-column layouts */
@page glossary {
  margin-left: 0.65in;
  margin-right: 0.65in;

  @top-center {
    content: "Glossary";
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
  }

  @bottom-center {
    content: counter(page);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }
}

/* Blank Pages */
@page blank {
  @top-left {
    content: none;
  }

  @top-right {
    content: none;
  }

  @bottom-left {
    content: none;
  }

  @bottom-right {
    content: none;
  }

  @bottom-center {
    content: "This page intentionally left blank";
    font-family: var(--font-ui);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    opacity: 0.4;
  }
}

/* ========================================
   AUTO-RULES FOR ELEMENTS
   ======================================== */

/* H1 headings automatically start chapters on right pages
   Applied by core-directives-plugin.ts */
.auto-chapter-start {
  page: chapter;
  break-before: right;
  /* Force right-hand page */
  string-set: section-title content();
}

/* Horizontal rules create page breaks
   Applied by core-directives-plugin.ts when --- is used */
.page-break {
  break-after: page;
  height: 0;
  visibility: hidden;
}

/* Full-bleed images get art page template
   Images with .full-bleed class automatically get .auto-art-page class
   Applied by core-directives-plugin.ts */
.auto-art-page,
img.auto-art-page {
  page: art;
  /* Activates @page art template (zero margins) */
  break-before: page;
  /* Force page break before image */
  width: 100%;
  /* Full width to bleed edge */
  height: 100%;
  /* Full height to bleed edge */
  object-fit: cover;
  /* Cover entire page, cropping if needed */
  margin: 0;
  /* Remove all margins */
  padding: 0;
  /* Remove all padding */
  border: none;
  /* Remove any borders */
  display: block;
  /* Ensure proper block rendering */
}

/* ========================================
   DIRECTIVE MARKERS
   ======================================== */

/* Minimal markers for directives
   These are invisible elements created by core-directives-plugin.ts
   to carry data attributes for CSS */
.directive-marker {
  height: 0;
  line-height: 0;
  overflow: hidden;
  position: absolute;
  width: 0;
}

/* Page spread markers */
[data-spread="left"]~* {
  break-before: left;
}

[data-spread="right"]~* {
  break-before: right;
}

[data-spread="blank"] {
  page: blank;
  break-before: page;
}

/* Column markers */
[data-columns="1"]~* {
  column-count: 1;
}

[data-columns="2"]~* {
  column-count: 2;
  column-gap: var(--column-gap);
  column-rule: var(--column-rule-width) var(--column-rule-style) var(--column-rule-color);
}

[data-columns="3"]~* {
  column-count: 3;
  column-gap: var(--column-gap);
  column-rule: var(--column-rule-width) var(--column-rule-style) var(--column-rule-color);
}

/* Auto-reset columns on chapter starts */
.auto-chapter-start {
  column-span: all;
}



/* ============================================================================
   COLUMN LAYOUTS
   ============================================================================ */

.two-column {
  columns: 2;
  column-gap: var(--default-gap);
}

.two-column-grid {
  display: grid;
  grid-template-columns: min-content 1fr;
}

/* ============================================================================
   POSITIONING UTILITIES
   ============================================================================ */

.center {
  left: 50%;
  transform: translateX(-50%);
}

.top-right {
  position: absolute;
  top: 0;
  right: 0;
}

.bottom-center {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
}

.bottom-right {
  position: absolute;
  bottom: 0;
  right: 0;
}

/* ============================================================================
   FLOAT UTILITIES
   ============================================================================ */

.float-left {
  float: left;
}

.float-right {
  float: right;
}

/* ============================================================================
   IMAGE UTILITIES
   ============================================================================ */

img {
  shape-outside: var(--image-shape);
}