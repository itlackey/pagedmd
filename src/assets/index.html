<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />

        <script type="module" src="/preview/scripts/toast.js"></script>
        <script src="/preview/scripts/preview.js"></script>
        <style>
            /* Toolbar styles - Enhanced visual hierarchy */
            .toolbar {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 56px;
                background: #1e1e1e;
                background: linear-gradient(
                    to bottom,
                    #252525 0%,
                    #1e1e1e 100%
                );
                color: white;
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                align-items: center;
                padding: 0 24px;
                z-index: 10000;
                box-shadow:
                    0 2px 12px rgba(0, 0, 0, 0.5),
                    0 1px 0 rgba(255, 255, 255, 0.05) inset;
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
                    sans-serif;
                gap: 24px;
                border-bottom: 1px solid #3a3a3a;

                & > * {
                    transition: none;
                }
            }

            .toolbar-section {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .toolbar-section:last-child {
                justify-content: flex-end;
            }

            .toolbar-title {
                font-size: 15px;
                font-weight: 600;
                color: #ffffff;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                letter-spacing: 0.01em;
            }

            /* Base button styles */
            .toolbar-btn {
                background: #3a3a3a;
                border: 1px solid #4a4a4a;
                color: #e0e0e0;
                padding: 7px 14px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 500;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                white-space: nowrap;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                position: relative;
            }

            .toolbar-btn svg {
                width: 16px;
                height: 16px;
                flex-shrink: 0;
                display: block;
            }

            /* Primary action buttons - Stand out with accent color */
            .toolbar-btn.primary,
            #btn-folder {
                background: linear-gradient(
                    to bottom,
                    #0077dd 0%,
                    #0066cc 100%
                );
                border-color: #0055aa;
                color: #ffffff;
                font-weight: 600;
                box-shadow:
                    0 2px 4px rgba(0, 102, 204, 0.3),
                    0 1px 0 rgba(255, 255, 255, 0.1) inset;
            }

            .toolbar-btn.primary:hover,
            #btn-folder:hover {
                background: linear-gradient(
                    to bottom,
                    #0088ee 0%,
                    #0077dd 100%
                );
                border-color: #0066cc;
                transform: translateY(-1px);
                box-shadow:
                    0 3px 6px rgba(0, 102, 204, 0.4),
                    0 1px 0 rgba(255, 255, 255, 0.15) inset;
            }

            /* Secondary action buttons - Subtle, don't compete with primary */
            .toolbar-btn.secondary {
                background: transparent;
                border: 1px solid #4a4a4a;
                color: #b0b0b0;
            }

            .toolbar-btn.secondary:hover {
                background: rgba(255, 255, 255, 0.05);
                border-color: #5a5a5a;
                color: #e0e0e0;
            }

            /* Default button hover state */
            .toolbar-btn:hover {
                background: #4a4a4a;
                border-color: #5a5a5a;
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .toolbar-btn:focus {
                outline: 2px solid #0066cc;
                outline-offset: 2px;
            }

            .toolbar-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) inset;
            }

            .toolbar-btn:disabled {
                opacity: 0.35;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .toolbar-btn:disabled:hover {
                background: #3a3a3a;
                border-color: #4a4a4a;
                transform: none;
                box-shadow: none;
            }

            /* Active state for toggle buttons */
            .toolbar-btn.active {
                background: linear-gradient(
                    to bottom,
                    #0077dd 0%,
                    #0066cc 100%
                );
                border-color: #0055aa;
                color: #ffffff;
                box-shadow:
                    0 2px 4px rgba(0, 102, 204, 0.3),
                    0 1px 0 rgba(255, 255, 255, 0.1) inset;
            }

            .toolbar-btn.active:hover {
                background: linear-gradient(
                    to bottom,
                    #0088ee 0%,
                    #0077dd 100%
                );
                box-shadow: 0 3px 6px rgba(0, 102, 204, 0.4);
            }

            .page-input {
                appearance: none;
                width: 50px;
                background: #3a3a3a;
                border: 1px solid #4a4a4a;
                color: #e0e0e0;
                padding: 6px 8px;
                border-radius: 4px;
                text-align: center;
                font-size: 13px;
                transition: all 0.15s ease-out;
            }

            .page-input:focus {
                outline: 2px solid #0066cc;
                outline-offset: 2px;
                border-color: #0066cc;
                background: #404040;
            }

            .toolbar-separator {
                width: 1px;
                height: 24px;
                background: #4a4a4a;
            }

            .zoom-select {
                background: #3a3a3a;
                border: 1px solid #4a4a4a;
                color: #e0e0e0;
                padding: 6px 8px;
                border-radius: 4px;
                font-size: 13px;
                cursor: pointer;
                transition: all 0.15s ease-out;
            }

            .zoom-select:focus {
                outline: 2px solid #0066cc;
                outline-offset: 2px;
                border-color: #0066cc;
                background: #404040;
            }

            .zoom-select:hover {
                background: #404040;
                border-color: #5a5a5a;
            }

            .status-text {
                font-size: 12px;
                color: #9ca3af;
                /* Gray-400 - WCAG AA compliant (4.6:1 contrast ratio) */
            }

            /* Iframe fade transitions */
            #preview-iframe {
                opacity: 0;
                transition: opacity 0.3s ease-in-out;
            }

            #preview-iframe.ready {
                opacity: 1;
            }
        </style>
        <link rel="stylesheet" href="/preview/styles/preview.css" />
        <link rel="stylesheet" href="/preview/styles/toast.css" />
    </head>

    <body>
        <div class="toolbar" style="width: stretch">
            <!-- Left section: Title and Folder Selector -->
            <div class="toolbar-section">
                <button
                    class="toolbar-btn"
                    id="btn-folder"
                    title="Select folder"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path
                            d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"
                        />
                    </svg>
                </button>
                <span class="toolbar-title" id="document-title"
                    >Preview</span
                >
            </div>

            <!-- Center section: Navigation -->
            <div class="toolbar-section">
                <button class="toolbar-btn" id="btn-first" title="First page">
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="m17 18-6-6 6-6" />
                        <path d="M7 6v12" />
                    </svg>
                </button>
                <button class="toolbar-btn" id="btn-prev" title="Previous page">
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="m15 18-6-6 6-6" />
                    </svg>
                </button>
                <input
                    type="number"
                    class="page-input"
                    id="page-input"
                    min="1"
                    value="1"
                    title="Current page"
                />
                <span class="status-text"
                    >/ <span id="total-pages">-</span></span
                >
                <button class="toolbar-btn" id="btn-next" title="Next page">
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="m9 18 6-6-6-6" />
                    </svg>
                </button>
                <button class="toolbar-btn" id="btn-last" title="Last page">
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="m7 18 6-6-6-6" />
                        <path d="M17 6v12" />
                    </svg>
                </button>
            </div>

            <!-- Right section: View controls -->
            <div class="toolbar-section">
                <button
                    class="toolbar-btn secondary"
                    id="btn-exit"
                    title="Exit preview server"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg>
                </button>
                <div class="toolbar-separator"></div>
                <button
                    class="toolbar-btn"
                    id="btn-single"
                    title="Single page view"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"
                        />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                    </svg>
                </button>
                <button
                    class="toolbar-btn active"
                    id="btn-two-column"
                    title="Two column view"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                        <path d="M12 3v18" />
                    </svg>
                </button>
                <div class="toolbar-separator"></div>
                <select class="zoom-select" id="zoom-select" title="Zoom level">
                    <option value="0.5">50%</option>
                    <option value="0.75">75%</option>
                    <option value="1" selected>100%</option>
                    <option value="1.25">125%</option>
                    <option value="1.5">150%</option>
                    <option value="2">200%</option>
                    <option value="fit-width">Fit Width</option>
                </select>
                <div class="toolbar-separator"></div>
                <button
                    class="toolbar-btn"
                    id="btn-debug"
                    title="Toggle debug mode (show crop marks and page boxes)"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect width="7" height="7" x="3" y="3" rx="1" />
                        <rect width="7" height="7" x="14" y="3" rx="1" />
                        <rect width="7" height="7" x="14" y="14" rx="1" />
                        <rect width="7" height="7" x="3" y="14" rx="1" />
                    </svg>
                </button>
                <button
                    class="toolbar-btn"
                    id="btn-bg-color"
                    title="Change background color"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path
                            d="M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z"
                        />
                        <circle cx="13.5" cy="6.5" r=".5" fill="currentColor" />
                        <circle
                            cx="17.5"
                            cy="10.5"
                            r=".5"
                            fill="currentColor"
                        />
                        <circle cx="6.5" cy="12.5" r=".5" fill="currentColor" />
                        <circle cx="8.5" cy="7.5" r=".5" fill="currentColor" />
                    </svg>
                </button>
                <input
                    type="color"
                    id="bg-color-picker"
                    class="bg-color-picker visually-hidden"
                    value="#454545"
                    title="Pick background color"
                />
                <div class="toolbar-separator"></div>
                <button
                    class="toolbar-btn"
                    id="btn-print"
                    title="Print (save as PDF)"
                    aria-label="Print (disabled while rendering)"
                >
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path
                            d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"
                        />
                        <path d="M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6" />
                        <rect x="6" y="14" width="12" height="8" rx="1" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Folder Selection Modal -->
        <div
            class="folder-modal"
            id="folder-modal"
            role="dialog"
            aria-modal="true"
            aria-labelledby="modal-title"
            aria-describedby="modal-description"
            style="display: none"
        >
            <div class="folder-modal-content">
                <div class="folder-modal-header">
                    <h3 id="modal-title">Select Content Folder</h3>
                    <button
                        class="folder-modal-close"
                        id="modal-close"
                        aria-label="Close folder selector"
                        type="button"
                    >
                        &times;
                    </button>
                </div>
                <p id="modal-description" class="visually-hidden">
                    Navigate through directories to select a folder containing
                    markdown files to preview. Use arrow keys to navigate
                    between folders, Enter to select, and Escape to close.
                </p>
                <div class="folder-modal-body">
                    <div class="folder-current-path">
                        <span id="current-path-display" aria-live="polite"
                            >Loading...</span
                        >
                    </div>
                    <div
                        class="folder-list"
                        id="folder-list"
                        role="list"
                        aria-label="Available folders"
                    >
                        <div class="folder-loading">Loading folders...</div>
                    </div>
                </div>
                <div class="folder-modal-footer">
                    <button
                        class="toolbar-btn"
                        id="btn-open-folder"
                        type="button"
                    >
                        Open This Folder
                    </button>
                </div>
            </div>
        </div>

        <!-- Status announcer for screen readers -->
        <div
            id="status-announcer"
            role="status"
            aria-live="polite"
            aria-atomic="true"
            class="visually-hidden"
        ></div>

        <div class="loading-overlay" id="loading-overlay">
            <div class="loading-content">
                <div
                    class="loading-spinner"
                    role="status"
                    aria-label="Loading preview"
                ></div>
                <div class="loading-message" id="loading-message">
                    Loading preview...
                </div>
                <span class="visually-hidden"
                    >Loading preview, please wait...</span
                >
            </div>
        </div>

        <!-- Shutdown overlay -->
        <div class="shutdown-overlay" id="shutdown-overlay">
            <div class="shutdown-content">
                <svg
                    class="shutdown-icon"
                    width="64"
                    height="64"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M18.36 6.64A9 9 0 0 1 20.77 15" />
                    <path d="M6.16 6.16a9 9 0 1 0 12.68 12.68" />
                    <path d="M12 2v4" />
                    <path d="m2 2 20 20" />
                </svg>
                <h2 class="shutdown-title">Preview Server Stopped</h2>
                <p class="shutdown-message">
                    The preview server has been shut down.<br />
                    You can close this browser window.
                </p>
            </div>
        </div>

        <!-- Preview iframe - Vite serves build output with HMR -->
        <iframe
            id="preview-iframe"
            src="/preview.html"
            allow="same-origin"
            style="
                position: fixed;
                top: 56px;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: calc(100vh - 56px);
                border: none;
            "
            title="Book preview content"
            aria-label="Book preview content"
        ></iframe>
    </body>
</html>
